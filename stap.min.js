"use strict";function addCSS(t){document.head.appendChild(document.createElement("style")).innerHTML=t}function findCSSrule(t){for(var e,i=0;i<document.styleSheets.length;++i){e=document.styleSheets[i].rules||document.styleSheets[i].cssRules;for(var n=0;n<e.length;++n)if(e[n].selectorText.indexOf(t)>-1)return e[n]}}function urlInDocument(t,e,i){for(var n=document.getElementsByTagName(t),o=0;o<n.length;++o)if(n[o][e]==i)return!0}function load(urls,callback,onerror,type){var url,onload,fileref;if(urls.constructor===Array?(url=urls[0],urls=urls.slice(1)):(url=urls,urls=[]),onload=urls.length?function(){load(urls,callback,onerror,type)}:callback||function(){},url&&(url.endsWith(".js")||"js"===type))urlInDocument("script","src",url)||(fileref=document.createElement("script"),fileref.setAttribute("type","text/javascript"),fileref.setAttribute("src",url));else{if(!url||!url.endsWith(".css")&&"css"!==type){try{eval(url)}catch(t){console.warn("Not sure how to handle "+url+".\nWill try to add as <style>..."),addCSS(url)}return void onload()}urlInDocument("link","href",url)||(fileref=document.createElement("link"),fileref.setAttribute("rel","stylesheet"),fileref.setAttribute("type","text/css"),fileref.setAttribute("href",url))}if(fileref){fileref.onreadystatechange=onload,fileref.onload=onload;try{var urlo=new URL(url);fileref.onerror=function(){load(urlo.pathname.split("/").pop(),onload,onerror,type)}}catch(t){fileref.onerror=onerror||function(t){console.error(t),onload()}}document.head.appendChild(fileref)}}function createSVG(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function objectify(t){var e={};for(var i in t)"object"==typeof t[i]?e[i]=objectify(t[i]):e[i]=t[i];return e}location.params={},location.search.substr(1).split("&").forEach(function(t){var e=t.split("=");location.params[e[0]]=e[1]}),Math.round2=((t,e)=>Math.round(t/e)*e),Date.prototype.format=function(t){function e(t){return t<10?"0"+t:t}var i,n="";return t.includes("Y")&&(n+=this.getUTCFullYear()),t.includes("M")&&(n+=(n.length?"-":"")+e(this.getUTCMonth()+1)),t.includes("D")&&(n+=(n.length?"-":"")+e(this.getUTCDate())),t.includes("d")&&(n+=(n.length?" ":"")+["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][this.getUTCDay()]),t.includes("h")&&(n+=(n.length?" ":"")+e(this.getUTCHours())),t.includes("m")&&(n+=(n.length?t.includes("h")?":":" ":"")+e(this.getUTCMinutes())),t.includes("s")&&(n+=(n.length?":":"")+e(this.getUTCSeconds())),t.includes(".")&&(n+=(n.length?".":"")+((i=this.getUTCMilliseconds())<10?"00"+i:i<100?"0"+i:i)),n},HTMLElement.prototype._listen=function(t,e){this._listeners||(this._listeners={}),this.addEventListener(t,e),this._listeners[t]=e},HTMLElement.prototype._removeListeners=function(){if(this._listeners)for(var t in this._listeners)this.removeEventListener(t,this._listeners[t])};var logline=function(){};function logToConsole(){logline=function(t,e){console.log((new Date).getTime()+"\t"+t+"\t"+JSON.stringify(e))}}function logToFirebase(){function t(){firebase.stapTask="tasks/"+(location.host+location.pathname).replace(/\/|\./g,"-"),firebase.stapSession="/"+firebase.stapTask+"/"+firebase.database().ref().child(firebase.stapTask).push().key;var t=-1;logline=function(e,i){firebase.database().ref(firebase.stapSession+"/"+ ++t+"/"+e).set(JSON.stringify(i))}}"undefined"!=typeof firebase?t():load("https://www.gstatic.com/firebasejs/4.11.0/firebase.js",function(){firebase.initializeApp({apiKey:"AIzaSyCy-9xDsJ5_xYF0iBA9sLcPgmERFgd2JyM",authDomain:"stap-5a32d.firebaseapp.com",databaseURL:"https://stap-5a32d.firebaseio.com",projectId:"stap-5a32d",storageBucket:"stap-5a32d.appspot.com",messagingSenderId:"944783602225"}),t()})}function logToVolunteerScience(){logline=function(t,e){submit((new Date).getTime()+"\t"+t+"\t"+JSON.stringify(e))}}"undefined"!=typeof submit&&"volunteerscience.com"===location.host&&logToVolunteerScience();var task={},ws,recv;function gui(t,e=!0){e&&logline(">",t),"id"in(t=Object.assign({},gui.prop(t)))&&t.id.constructor===Array?t.id.unshift(0):t.id=0,gui.rootOrigin._processProp(t)}gui.REQUIRED={S:["https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.1/TweenLite.min.js","https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.1/plugins/ColorPropsPlugin.min.js","TweenLite.defaultEase = Linear.easeNone;"],ease:"https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.1/easing/EasePack.min.js",Mkdn:["https://cdn.jsdelivr.net/npm/marked/marked.min.js","gui.markdown=marked;"]},gui.OPTIONS=new Set(["*","O","P","Q","R","S","T","U","ease","easeout"]),gui.OPTION_VALUES_IMPLEMENTED={select:t=>-1!==[-1,0,1,2].indexOf(t),ease:t=>t in gui.EASE},gui.COLOROPTIONS=new Set(["bg","c","lc"]),gui.SIZEOPTIONS=["x","y","w","h","lw"],gui.ANIMATABLE=new Set(["x","y","w","h","bg","lw","lc","c","rot"]),gui.EASE={0:"Power0",1:"Power1",2:"Power2",3:"Power3",4:"Power4",back:"Back",elastic:"Elastic",bounce:"Bounce"},gui.ums=function(){return(new Date).getTime()-gui.startTime},gui.sendAction=function(t,e){var i=gui.ums();logline("<",[i,t,e]),gui.action(i,t,e)},gui.defaultType=function(t){return{object:gui.Bin,string:gui.Txt,number:gui.Num,boolean:gui.Btn}[typeof t]},gui.getType=function(t){if(t.type){var e=t.type.charAt(0).toUpperCase()+t.type.slice(1);if(e in gui)return gui[e]}},gui.prop=(t=>null===t||t.constructor!==Object?{v:t}:t),gui.getColor=(t=>getComputedStyle(document.body).getPropertyValue("--color"+t)),gui.color=(t=>gui.getColor(t)?`var(--color${t})`:t),gui.queue={},gui.animations={},gui.error=function(t){console.error(t)},gui.require=function(t){var e,i=[],n=new Set([gui.Item,gui.Txt,gui.Num,gui.Btn,gui.Bin]);if(t.type){t.type.constructor!==Array&&(t.type=[t.type]),e=[];for(var o=0;o<t.type.length;++o)if(t.type[o]){if((r=t.type[o][0].toUpperCase()+t.type[o].substr(1))in gui.REQUIRED)return delete t.type[o],void load(gui.REQUIRED[r],function(){n.add(gui[r]),gui.require(t)});gui[r]?n.add(gui[r]):e.push(r)}e.length&&(gui.sendAction(0,{error:"Sorry, I cannot handle the required value type(s): "+e}),i.push({id:"Cannot handle required value type(s)",v:e})),delete t.type}for(var r of n)for(var s of Object.getOwnPropertyNames(r.prototype))r.prototype[s].call&&!s.startsWith("_")&&gui.OPTIONS.add(s);if(t.options){for(var s of(e=[],t.options))gui.OPTIONS.has(s)?s in gui.REQUIRED&&load(gui.REQUIRED[s]):e.push(s);e.length&&(gui.sendAction(0,{error:"Sorry, I cannot handle the required property option(s): "+e}),i.push({id:"Cannot handle required property option(s)",v:e})),delete t.options}if(t.emphases){for(var a in e=[],t.emphases)if(gui.Item.prototype.hasOwnProperty(a))for(o=1;o<=t.emphases[a];o++)findCSSrule(`[${a}="${o}"]`)||e.push(`${a}=${o}`);else e.push(a);e.length&&(gui.sendAction(0,{error:"Sorry, I cannot handle required emphasis type(s): "+e}),i.push({id:"Cannot handle required emphasis type(s)",v:e})),delete t.emphases}if(t.shape){e=[];for(o=0;o<t.shape.length;o++)findCSSrule(`[shape="${t.shape[o]}"]`)||e.push(t.shape[o]);e.length&&(gui.sendAction(0,{error:"Sorry, I cannot handle required shape(s): "+e}),i.push({id:"Cannot handle required shape(s)",v:e})),delete t.shape}if(t.shapes){e=[];for(o=1;o<=t.shapes;o++)findCSSrule(`[shape="${o}"]`)||findCSSrule(`[shape=${o}]`)||e.push(o);e.length&&(gui.sendAction(0,{error:"Sorry, I cannot handle required shape(s): "+e}),i.push({id:"Cannot handle required shape(s)",v:e})),delete t.shapes}if(t.colors){e=[];for(o=0;o<=t.colors;++o)gui.getColor(o)||e.push(o);e.length&&(gui.sendAction(0,{error:"Sorry, I cannot handle required color(s): "+e}),i.push({id:"Cannot handle required color(s)",v:e})),delete t.colors}for(var s in t){if(gui.OPTIONS.has(s)){if(s in gui.OPTION_VALUES_IMPLEMENTED)for(var l of(t[s].constructor!==Array&&(t[s]=[t[s]]),t[s]))gui.OPTION_VALUES_IMPLEMENTED[s](l)||(gui.sendAction(0,{error:"Sorry, I cannot handle required option-value: {"+s+":"+l+"}"}),i.push({id:"Cannot handle required property option(s)",v:["{"+s+":"+l+"}"]}))}else gui.sendAction(0,{error:"Sorry, I cannot handle required option: "+s}),i.push({id:"Cannot handle required property option(s)",v:[s]});i.length||s in gui.REQUIRED&&load(gui.REQUIRED[s])}i.length&&(gui(null),gui([{id:"Error",v:i}]),ws&&ws.close())},gui.template=function(t){load(t)},addCSS('\n:root {\n--color0: white;\n--colorHead: #f0f8f8;\n--colorBorder: #e8e8e8;\n--colorFalse: #f8f8f8;\n--colorTrue: lightblue;\n--color1: #444444;\n--color2: #0099ff;\n--color3: #ff9900;\n--color4: #99ff99;\n--color5: red;\n--color6: green;\n--color7: blue;\n}\nbody {background-color:var(--color0);color:var(--color1);font-size:18pt;}\n[level="-1"],[level="0"],[level="-1"]>*,[level="0"]>* {margin:0px;padding:0px;width:100%;height:100%;}\n[level] {border:solid 0px var(--color1)}\ndiv {position:relative;box-sizing:border-box;font-size:96%;flex:0 0 auto;flex-direction:column;margin:3px;}\n.title:not(empty):not(td) {white-space:nowrap;}\n[v] {overflow:auto}\n'),gui.Item=class{constructor(t,e){for(var i in this._parent=e,this._initContent(),this._setAttrC("v",""),this._title.className="title",this._content._item=this._element._item=this._outterElement._item=this,this._setAttr("type",this.type),this._level=e._level+1,this._setAttr("level",this._level),t.id&&(this._setAttr("id",t.id),this.title(t.id)),this._prop={id:t.id},this._initDefaults(),this._update(t),this._parent._defaults)i in this._prop||this._refreshProp(i,this._parent._defaults[i])}_initContent(){this._element=document.createElement("div"),this._title=this._element.appendChild(document.createElement("div")),this._content=this._element.appendChild(document.createElement("div")),this._parent._placeChildElement(this)}_initDefaults(){}_attr(t){return this._element.getAttribute(t)}_setAttr(t,e){null===e?this._element.removeAttribute(t):this._element.setAttribute(t,e)}_attrC(t){return this._content.getAttribute(t)}_setAttrC(t,e){null===e?this._content.removeAttribute(t):this._content.setAttribute(t,e)}_animatable(t){return gui.ANIMATABLE.has(t)}_animate(t){var e=t.S,i={},n={},o=this;for(var r in delete t.S,t)this._animatable(r)&&(gui.COLOROPTIONS.has(r)?(n[r]=this._prop[r]||"rgba(0,0,0,0)",i[r]=gui.getColor(t[r])||t[r]):(n[r]=this._prop[r]||this._defaults[r]||0,i[r]=t[r]),delete t[r]);if(Object.keys(i).length){var s={};t.ease&&(-1==t.easeout?i.ease=window[gui.EASE[t.ease]].easeIn:0==t.easeout?i.ease=window[gui.EASE[t.ease]].easeInOut:i.ease=window[gui.EASE[t.ease]].easeOut,delete t.ease,delete t.easeout),i.onUpdate=function(t){document.body.contains(o._element)?o._update(t):s.ani.kill()},i.onUpdateParams=[n],i.onComplete=function(){o._update(t),"Q"in t&&delete gui.animations[t.Q]},s.ani=TweenLite.to(n,e,i),"Q"in t&&(gui.animations[t.Q]=s.ani)}}_delay(t,e){var i=this,n=setTimeout(function(){"Q"in t&&delete gui.queue[t.Q],i._update(t)},e);"Q"in t&&(gui.queue[t.Q]=n)}_update(t){if(t.U){let e=t.U-gui.ums();delete t.U,this._delay(t,e)}else if(t.T){let e=1e3*t.T;delete t.T,this._delay(t,e)}else if(t.S)this._animate(t);else for(var e in Object.assign(this._prop,t),t)this._refreshProp(e,t[e]),null===t[e]&&delete t[e]}_refreshProp(t,e){t in this&&"type"!==t&&this[t](e)}_value(t){this._prop.v=t,this.v(t)}_getIndex(){for(var t=0,e=this._outterElement;null!==(e=e.previousElementSibling);)++t;return t}_match(t){if(t.constructor===String){if((this._prop.id||"")===t)return!0;if(this._prop.tags&&this._prop.tags.indexOf(t)>-1)return!0}else{if(t.constructor===Object){for(var e in t)if("id"===e){if(t.id.constructor===Number){if(this._getIndex()!==t.id)return!1}else if(t.id){if(t.id!==this._prop.id)return!1}else if(this._prop.id)return!1}else{if("type"===e)return this.type===t[e];if(this._prop[e]&&this._prop[e].constructor===Array)return this._prop[e].indexOf(t[e])>-1;if(t[e]!==this._prop[e])return!1}return!0}if(t.constructor===Number)return this._getIndex()===t}}_sendAction(t){var e=this._prop.id||this._getIndex();if(this._patronym>0){for(var i=[e],n=0,o=this._parent;o&&n++<this._patronym;o=o._parent)i.push(o._prop.id||o._getIndex());i.length>1&&(e=i.reverse())}gui.sendAction(e,t),this.O(1)}v(t){this._content.innerText=t}id(){}title(t){this._title.innerText=null==t?this._prop.id:t}tags(t){if(t){t.constructor!==Array&&(t=[t],this._prop.tags=t);for(var e=0;e<t.length;e++)this._element.classList.add(t[e])}}},addCSS("\n[type='txt'] > .title:empty {width:0px;height:0px;overflow:hidden}\n[type='txt'] > .title:not(empty) {border-bottom:solid 1px var(--colorBorder);width:25%;}\n[type='txt'] > [v] {white-space:pre-wrap;}\n"),gui.Txt=class extends gui.Item{},gui.Txt.prototype.type="txt",addCSS("\n[type='num'] > .title:empty {width:0px;height:0px;overflow:hidden}\n[type='num'] > .title:not(empty) {border-bottom:solid 1px var(--colorBorder);vertical-align:top;margin-top:inherit}\n[type='num'] > .title:not(empty):after {content:\":\"}\n[type='num'] > [v] {display:inline-block}\n"),gui.Num=class extends gui.Item{_animatable(t){return"v"===t||gui.ANIMATABLE.has(t)}},gui.Num.prototype.type="num",addCSS("\n[in=\"1\"] {cursor:pointer;user-select:none;}\n[in=\"0\"] {pointer-events:none;opacity:.5;contenteditable:false}\n[type='btn']:active {background-color:var(--colorTrue) !important;}\n[type='btn'] {text-align:center;display:inline-block;padding:.4em;color:var(--color1);border:1px solid rgba(0,0,0,0.2);background-color:var(--colorFalse);box-shadow: 0 0 5px -1px rgba(0,0,0,0.2);cursor:pointer;vertical-align:middle;}\n[type='btn']:not(:empty),[select=\"0\"]:not(:empty) {min-width:100px;border-radius:4px;}\n[type='btn'][in]:empty {width:1em;height:1em;border-radius:2em;}\n[btnContainer] [type='btn'] {display:none}\n[btnContainer]:active {background-color:var(--colorTrue) !important;}\n[btnContainer] {border:1px solid rgba(0,0,0,0.2);background-color:var(--colorFalse);box-shadow: 0 0 5px -1px rgba(0,0,0,0.2);cursor:pointer;border-radius:4px;}\n"),gui.Btn=class extends gui.Item{_initContent(){this._element=document.createElement("div"),this._content=this._element,this._title=this._element,this._parent._placeChildElement(this),this._bind(this)}_initDefaults(){this._defaults=Object.assign({in:1},this._parent._defaults)}v(t){if(t){var e=this;e._prop.v=!1,setTimeout(function(){e._setAttrC("v",!1)},200)}}_bind(t){var e=this;this._unbind&&this._unbind(),t._element.onclick=function(){e._sendAction(!0)},this._unbind=function(){t._element.onclick=null}}},gui.Btn.prototype.type="btn",addCSS("\n[type='bin'] {display:grid;grid-template-rows: auto 1fr;}\n[type='bin'] > .title:empty {width:0px;height:0px;overflow:hidden}\n[type='bin'] > .title:not(empty) {border-bottom:solid 1px var(--colorBorder);}\n[type='bin'] > [v] {display:block}\n"),gui.Bin=class extends gui.Item{_initDefaults(){this._defaults=Object.assign({},this._parent._defaults),this._childmap={}}*[Symbol.iterator](){var t,e;for(t=this._content.children.length;t--;)(e=this._content.children[t]._item)&&(yield e)}_getChild(t){if("number"==typeof t){var e=this._content.children[t];if(e)return e._item}else if("string"==typeof t)return this._childmap[t]}_placeChildElement(t){this._content.appendChild(t._element),t._outterElement=t._element}_checkContainerBool(){var t;for(var e of this)if(e instanceof gui.Btn){if(t)return null;t=e}if(t&&(""==t._prop.title||!t._prop.title&&!t._prop.id))return t}_newChild(t){var e=gui.getType(t);if(!e){var i=gui.getType(this._defaults);"v"in t?(e=gui.defaultType(t.v),i&&i.prototype instanceof e&&(e=i)):i?e=i:"v"in this._defaults?e=gui.defaultType(this._defaults.v):(e=gui.Bin,t.v=[])}var n=new e(t,this);void 0!==n._prop.id&&(this._childmap[n._prop.id]=n)}_processChild(t,e){if(null===e.v)this._removeChild(t,e);else{var i=gui.getType(e);!i||t instanceof i?t._update(e):t._parent?this._changeChildType(t,propType,e):gui.sendAction(0,{error:"Root element must be a container type."})}}_changeChildType(t,e,i){t._prop.id&&(i.id=t._prop.id);var n=new e(Object.assign({},t._prop,i),this);this._content.replaceChild(n._outterElement,t._outterElement),t._prop.id&&(this._childmap[i.id]=n)}_removeChild(t){t._prop.id&&delete this._childmap[t._prop.id],this._content.removeChild(t._outterElement)}_search(t){var e=1;for(var i of(t["*"].constructor===Object&&"scope"in t["*"]&&(e=t["*"].scope,delete t["*"].scope),e>1?gui.rootContainer:this))i._match(t["*"])&&this._processChild(i,Object.assign({},t)),e&&i instanceof gui.Bin&&i._search(t)}_processProp(t){if("Q"in t&&(gui.queue[t.Q]&&(clearTimeout(gui.queue[t.Q]),delete gui.queue[t.Q]),gui.animations[t.Q]&&(gui.animations[t.Q].kill(),delete gui.animations[t.Q])),"*"in t)this._search(t);else{var e;if("id"in t){if(t.id.constructor===Array&&t.id.length){if(null===t.id[0])return 1===t.id.length?delete t.id:t.id=t.id.slice(1),void gui(t);if(1===t.id.length)t.id=t.id[0];else{var i=t.id[0];t.id=t.id.slice(1),t={v:[t],id:i}}}e=this._getChild(t.id),t.id.constructor===Number&&delete t.id}e?this._processChild(e,t):null!==t.v&&this._newChild(t)}}v(t){for(var e of t)this._processProp(gui.prop(e));this._containerBoolean&&this._containerBoolean._bind(this._containerBoolean),this._containerBoolean=this._checkContainerBool(),this._containerBoolean?(this._containerBoolean._bind(this),this._setAttr("btnContainer",1),this._setAttr("v",Boolean(this._containerBoolean._prop.v))):this._setAttr("btnContainer",null)}},gui.Bin.prototype.type="bin",function(){function t(){gui(null),gui.startTime=(new Date).getTime(),window.addEventListener("unload",function(){gui.sendAction(0,["onunload"])},!1)}window.addEventListener("load",function(){logToConsole(),document.body._level=-2,document.body._content=document.body,document.body._placeChildElement=function(t){this._content.appendChild(t._element),t._outterElement=t._element},gui.rootOrigin=new gui.Bin({},document.body),gui.rootOrigin._removeChild=function(t){gui.rootContainer._content.innerHTML="",gui.rootContainer._childmap={},gui.rootContainer._prop={select:-1,eB:1,task:gui.rootContainer._prop.task}},gui.rootContainer=new gui.Bin({df:{su:"px"}},gui.rootOrigin),gui.rootContainer._parent=null,document.body._item=gui.rootContainer,window._item=gui.rootContainer,gui.rootContainer.error=gui.error,gui.rootContainer.require=gui.require,gui.rootContainer.agent=gui.agent,gui.rootContainer.template=gui.template,task.userAction?(task.userAction&&(gui.action=task.userAction),task.show=function(t){gui(JSON.parse(JSON.stringify(t)))},task.end=function(){},t(),task.start&&task.start()):task.location||location.params.l?(gui(["Loading..."]),task.location=task.location||location.params.l,task.location.startsWith("ws://")||task.location.startsWith("wss://")?(logToConsole(),"WebSocket"in window?(gui.action=function(t,e,i){ws.send(JSON.stringify([t,e,i]))},(ws=new window.WebSocket(task.location)).onerror=function(t){gui(null),gui({error:"Cannot establish connection to "+task.location})},ws.onopen=t,ws.onclose=function(t){console.log("Connection closed ("+t.code+").")},ws.onmessage=function(t){gui(JSON.parse(t.data))}):(gui(null),gui([{id:"Error",v:"Your browser does not support websockets. Please use a modern browser to run this application."}]))):function(){function e(){if(4==this.readyState)if(200==this.status){gui.httpParrotHeader=null,gui.httpAppendToURL=null,this.getAllResponseHeaders().split("\n").forEach(t=>{"x-parrot:"==t.substr(0,9).toLowerCase()&&(gui.httpParrotHeader=t.substr(10)),"x-append-to-url:"==t.substr(0,16).toLowerCase()&&(gui.httpAppendToURL=t.substr(17))});try{var t=this.responseText.match(/[^\r\n]+/g);if(t)for(var e=0;e<t.length;e++)gui(JSON.parse(t[e]))}catch(t){console.error("Could not parse response.\n",this.responseText)}}else if(this.status>200&&this.status<400){var i=new URL(this.responseText);console.log(this.statusText+"\n  "+i.href),task.location=i.href,gui.sendAction(0,[0])}}gui.action=function(t,i,n){!function(t,i=""){var n=new XMLHttpRequest;n.onreadystatechange=e,gui.httpAppendToURL&&(t+=(-1==t.indexOf("?")?"?":"&")+gui.httpAppendToURL),n.open("POST",t,!0),gui.httpParrotHeader&&n.setRequestHeader("X-parrot",gui.httpParrotHeader),n.send(i)}(task.location,JSON.stringify([t,i,n]))},gui.action(0,null,["onload"]),t()}()):gui(["Hey there...",{id:"Intersted in the STAP?",v:"http://stap7.github.io/"}])})}(),gui.INFO={ip:async()=>gui.ip=await fetch("https://api.ipify.org/").then(t=>t.text()),userAgent:()=>navigator.userAgent,url:()=>location.href,screen:()=>objectify(screen),id:t=>t._getIndex(),mouseX:t=>t._event.clientX-t._element.getBoundingClientRect().left,mouseY:t=>t._event.clientY-t._element.getBoundingClientRect().top,key:t=>t._event.key,code:t=>t._event.code,keyLocation:t=>t._event.location,modKeys(t){var e=t._event;return e.shiftKey+2*e.altKey+4*e.ctrlKey+8*e.metaKey},bounds:t=>t._element.getBoundingClientRect()},gui.Item.prototype._getInfo=function(t){return t in gui.INFO?gui.INFO[t](this):this._prop[t]},gui.Item.prototype.R=async function(t){var e=[];null!==t[0]&&void 0!==t[0]&&e.push(t[0]);for(var i=1;i<t.length;i++)e.push(await this._getInfo(t[i]));gui.sendAction(this._prop.id||this._getIndex(),e)},gui.Item.prototype.P=function(t){var e,i;if(t.constructor===Array){i=gui.rootContainer;for(var n=0;n<t.length-1;n++)i=i._getChild(t[n]);t=t[n],void 0!==this._prop.id&&(this._parent._childmap[this._prop.id]=void 0)}else i=this._parent;if(i){if(e=i._getChild(t))i._content.insertBefore(this._outterElement,e._outterElement);else{var o=this;setTimeout(function(){i._placeChildElement(o)},1)}void 0!==this._prop.id&&(i._childmap[this._prop.id]=this)}},gui.Item.prototype.O=function(t){var e=1==t?this._onedit:this._prop[t];e&&(e.id||e["*"]?this._processProp?this._processProp(e):(this._parent||gui.rootOrigin)._processProp(e):(this._parent||gui.rootOrigin)._processChild(this,e))},gui.onEvent=function(t){t.repeat||(this._item._event=t,this._item.O("on"+t.type))},gui.Item.prototype._onEvent=function(t,e){e&&e.constructor===Object?(e.R||(this._prop[t].R=[t]),(this===gui.rootContainer?document.body:this._element).addEventListener(t.substring(2),gui.onEvent)):(this===gui.rootContainer?document.body:this._element).removeEventListener(t.substring(2),gui.onEvent)},gui.Item.prototype.onkeydown=function(t){this._onEvent("onkeydown",t)},gui.Item.prototype.onkeyup=function(t){this._onEvent("onkeyup",t)},gui.Item.prototype.onclick=function(t){this._onEvent("onclick",t)},gui.Item.prototype.ondblclick=function(t){this._onEvent("ondblclick",t)},gui.Item.prototype.onmousemove=function(t){this._onEvent("onmousemove",t)},gui.Item.prototype.onmouseover=function(t){this._onEvent("onmouseover",t)},gui.Item.prototype.onmouseout=function(t){this._onEvent("onmouseout",t)},gui.Item.prototype.onmouseenter=function(t){this._onEvent("onmouseenter",t)},gui.Item.prototype.onmouseleave=function(t){this._onEvent("onmouseleave",t)},gui.Item.prototype.onmousedown=function(t){this._onEvent("onmousedown",t)},gui.Item.prototype.onmouseup=function(t){this._onEvent("onmouseup",t)},gui.Item.prototype.onfocus=function(t){this._onEvent("onfocus",t)},gui.Item.prototype.onblur=function(t){this._onEvent("onblur",t)};const OVERLAP=new Event("overlap"),OVEROUT=new Event("overout");gui.checkForOverlap={},gui.overlap=function(t,e){return!(t.left>e.right||e.left>t.right)&&!(t.top>e.bottom||e.top>t.bottom)},gui._items=0,gui.Item.prototype._getUniqueIndex=function(){return this.__uniqueIndex||(this.__uniqueIndex=++gui._items)},gui.Item.prototype._moveHook=function(){},gui.Item.prototype._overlapChecking=function(){this._prop.onoverlap||this._prop.onoverout?gui.checkForOverlap[this._getUniqueIndex()]||(gui.checkForOverlap[this._getUniqueIndex()]=this,this._moveHook=this._checkOverlap,this._checkOverlap()):(delete gui.checkForOverlap[this._getUniqueIndex()],this._moveHook=function(){})},gui.Item.prototype.onoverlap=function(t){this._onEvent("onoverlap",t),this._overlapChecking()},gui.Item.prototype.onoverout=function(t){this._onEvent("onoverout",t),this._overlapChecking()},gui.Item.prototype._checkOverlap=function(){var t,e,i=this._element.getBoundingClientRect();for(t in gui.checkForOverlap)(e=gui.checkForOverlap[t])!=this&&(gui.overlap(e._element.getBoundingClientRect(),i)?(this._element.dispatchEvent(OVERLAP),e._element.dispatchEvent(OVERLAP),this._priorOverlap||(this._priorOverlap={}),e._priorOverlap||(e._priorOverlap={}),this._priorOverlap[e._getUniqueIndex()]=e,e._priorOverlap[this._getUniqueIndex()]=this):this._priorOverlap&&this._priorOverlap[e._getUniqueIndex()]&&(delete this._priorOverlap[e._getUniqueIndex()],delete e._priorOverlap[this._getUniqueIndex()],this._element.dispatchEvent(OVEROUT),e._element.dispatchEvent(OVEROUT)))},gui.Btn.prototype.in=function(t){0==t||0==t?this._setAttr("in",0):this._setAttr("in",1)},gui.Item.prototype.onin=function(t){t&&t.constructor===Object?this._onedit=t:this._onedit=void 0},gui.Item.prototype.patronym=function(t){this._patronym=t},gui.Bin.prototype._default=function(t,e){for(var i of(null===e?t in this._parent._defaults?e=this._defaults[t]=this._parent._defaults[t]:delete this._defaults[t]:this._defaults[t]=e,this)){if(!(t in i._prop))if("type"===t){if(e!==i.type){var n=gui.getType({type:e});n&&this._changeChildType(i,n,{})}}else i._refreshProp(t,e);!i.df||t in i._defaults||i._default(t,e)}},gui.Bin.prototype.df=function(t){if(null===t)for(var e in t={},this._defaults)t[e]=null;for(var e in t)this._default(e,t[e])},addCSS('\n[emp="1"] {font-weight:bold}\n[emp="2"] {font-weight:bold;font-style:italic}\n[emp="3"] {font-weight:bold;font-style:italic;text-decoration:underline}\n[emp="4"] {font-weight:bold;font-style:italic;text-decoration:underline;font-size:110%}\n[emp="5"] {font-weight:bold;font-style:italic;text-decoration:underline;font-size:120%}\n[emp2="1"] {background-color:rgba(255,255,0,.2);box-shadow: 0 0 0px 4px rgba(255,255,0,0.2);}\n[emp2="2"] {background-color:rgba(255,255,0,.4);box-shadow: 0 0 0px 4px rgba(255,255,0,0.3);}\n[emp2="3"] {background-color:rgba(255,255,0,.6);box-shadow: 0 0 0px 4px rgba(255,255,0,0.4);}\n[emp2="4"] {background-color:rgba(255,255,0,.8);box-shadow: 0 0 0px 4px rgba(255,255,0,0.5);}\n[emp2="5"] {background-color:rgba(255,255,0,1);box-shadow: 0 0 5px -1px rgba(255,255,0,0.6);}\n'),gui.Item.prototype.emp=function(t){this._setAttr("emp",t)},gui.Item.prototype.emp2=function(t){this._setAttr("emp2",t)},gui.Item.prototype.opc=function(t){this._element.style.opacity=t},gui.Item.prototype.bg=function(t){this._path?this._path.setAttribute("fill",gui.color(this._prop.bg?this._prop.bg:0===this._prop.bg?0:"none")):this._element.style.background=gui.color(t)},gui.Item.prototype.c=function(t){this._element.style.color=gui.color(t)},gui.Item.prototype.fnt=function(t){this._element.style.font=t},gui.Item.prototype.lc=function(t){this._path?this._path.setAttribute("stroke",gui.color(this._prop.lc?this._prop.lc:0===this._prop.lc?0:1)):this._element.style.borderColor=gui.color(t)},gui.Item.prototype.lw=function(t){this._path?this._path.style.strokeWidth=this._getSize(t,{"%w":"%","%h":"%"})||0:this._element.style.borderWidth=this._getSize(t,{"%":"%w"})},addCSS('\n[shape] {text-align:center;}\n[shape="rect"],[shape="0"] {border-radius:0px  !important} \n[shape="roundedRect"],[shape="2"] {border-radius:.4em  !important}\n[shape="round"],[shape="1"] {border-radius:100%  !important}\n[shape="roundTop"],[shape="6"] {border-radius:100% 100% 0px 0px  !important}\n[shape="roundBottom"],[shape="3"] {border-radius:0px 0px 100% 100%  !important}\n[shape="roundLeft"],[shape="4"] {border-radius:100% 0px 0px 100%  !important}\n[shape="roundRight"],[shape="5"] {border-radius:0px 100% 100% 0px  !important}\nsvg {width:100%;height:100%;left:0px;top:0px;position:absolute;z-index:0 }\n'),gui.Item.prototype.shape=function(t){this._setAttr("shape",t),t.constructor===Array?(this._element.style.background="",this._element.style.borderWidth=0,this._svg||(this._svg=this._element.insertBefore(createSVG("svg"),this._title),this._svg.setAttribute("viewBox","0 0 100 100"),this._svg.setAttribute("preserveAspectRatio","none")),this._path||(this._path=this._svg.appendChild(createSVG("path"))),this._path.setAttribute("d",(isNaN(parseInt(t[0]))?"":"M")+t.join(" "))):this._svg&&(this._element.removeChild(this._svg),delete this._svg,delete this._path),this.bg(this._prop.bg),this.lw(this._prop.lw),this.lc(this._prop.lc)},gui.Item.prototype.w=function(t,e){this._element.style.width=this._getSize(t),e||this._moveHook()},gui.Item.prototype.h=function(t,e){this._element.style.height=this._getSize(t),e||this._moveHook()},gui.Item.prototype.z=function(t){this._element.style.zIndex=10+t},gui.Item.prototype.rot=function(t){this._element.style.setProperty("transform","rotate("+t+"deg)")},addCSS("\n[x],[y] {position:absolute;margin:0px}\n[childPos] > [v] {margin:0px;position:absolute;top:0px;left:0px;width:100%;height:100%;overflow:visible}\n"),gui.Bin.prototype._hasPositionedElements=function(){for(var t of this)if("absolute"===getComputedStyle(t._element).position)return!0;return null},gui.Item.prototype.x=function(t,e){this._element.style.left=this._getSize(t),this._setAttr("x",t),this._parent._setAttr("childPos",this._parent._hasPositionedElements()),e||this._moveHook()},gui.Item.prototype.y=function(t,e){this._element.style.top=this._getSize(t),this._setAttr("y",t),this._parent._setAttr("childPos",this._parent._hasPositionedElements()),e||this._moveHook()},gui.Item.prototype.su=function(t){for(var e of(this._su=t,gui.SIZEOPTIONS))e in this._prop&&this[e](this._prop[e],!0);this._moveHook()},gui.Item.prototype._getSize=function(t,e){var i;return null==t&&(t=0),t.constructor===String?(i=(i=t.match(/[a-zA-Z%]+/))?i[0]:this._su,t=parseFloat(t)):i=this._su,e&&i in e&&(i=e[i]),"%w"===i?t*this._element.offsetWidth/100+"px":"%h"===i?t*this._element.offsetHeight/100+"px":t+i},addCSS("\n[contenteditable=true] {background-color:white;min-width:100px;padding-left:5px;padding-right:5px;border:solid 1px lightgray;font-family:monospace;pointer-events:all}\n"),gui.Txt.prototype.in=function(t){var e=this._content;if(e._removeListeners(),t>0){e.setAttribute("contenteditable",!0);var i=this._content.innerText.indexOf("\n")+this._content.innerText.indexOf("\r")>-2;function n(){e.innerText!=e._item._prop.v&&(e._item._prop.v=e.innerText,e._item._sendAction(e.innerText))}e._listen("paste",function(t){t.preventDefault();var e=t.clipboardData.getData("text/plain");document.execCommand("insertText",!1,i?e.replace(/\n|\r/g," "):e)}),i?2==t?e._listen("input",n):e._listen("blur",n):2==t?(e._listen("keypress",t=>{13==t.keyCode&&t.preventDefault()}),e._listen("input",n)):(e._listen("keypress",t=>{13==t.keyCode&&(t.preventDefault(),n())}),e._listen("blur",n))}else e.removeAttribute("contenteditable")},gui.Txt.prototype.v=function(t){this._content.innerText=t;var e=this._prop.in||this._parent._defaults.in;e&&this.in(e)},addCSS("\n[type='num'] > [unit]:after {content: attr(unit);}\n"),gui.Num.prototype.in=function(t){var e=this._content;if(e._removeListeners(),t>0){function i(){e.innerText!=e._item._prop.v&&(e._item._value(parseFloat(e.innerText)),e._item._sendAction(e._item._prop.v))}e.setAttribute("contenteditable",!0),e._listen("paste",t=>{t.preventDefault();var e=parseFloat(t.clipboardData.getData("text/plain"));isNaN(e)||document.execCommand("insertText",!1,e)}),e._listen("blur",i),e._listen("keypress",t=>{13==t.keyCode?(t.preventDefault(),i()):t.key&&-1=="0123456789e.".indexOf(t.key)&&t.preventDefault()})}else e.removeAttribute("contenteditable")},gui.Num.prototype.unit=function(t){this._setAttrC("unit",t)},gui.Num.prototype.max=function(t){this._max=null===t?void 0:t,this.v(this._prop.v)},gui.Num.prototype.min=function(t){this._min=null===t?void 0:t,this.v(this._prop.v)},gui.Num.prototype.rnd=function(t){this._rnd=null===t?void 0:t,this.v(this._prop.v)},gui.Num.prototype.time=function(t){this._setAttr("time",t),this.v(this._prop.v)},gui.Num.prototype.v=function(t){t||(t=0),void 0!==this._min&&(t=Math.max(t,this._min)),void 0!==this._max&&(t=Math.min(t,this._max)),void 0!==this._rnd&&(t=Math.round2(t,this._rnd)),this._attr("time")?t=new Date(1e3*t).format(this._attr("time")):this._rnd<1&&(t=t.toFixed(this._rnd.toString().split(".")[1].length)),this._content.innerText=t},addCSS("\n[type='hold']:active {background-color:var(--colorTrue) !important;}\n[type='hold'] {text-align:center;display:inline-block;padding:.4em;color:var(--color1);border:1px solid rgba(0,0,0,0.2);background-color:var(--colorFalse);box-shadow: 0 0 5px -1px rgba(0,0,0,0.2);cursor:pointer;vertical-align:middle;}\n[type='hold']:not(:empty),[select=\"0\"]:not(:empty) {min-width:100px;border-radius:4px;}\n[type='hold'][in]:empty {width:2em;height:2em;border-radius:2em;}\n"),gui.Hold=class extends gui.Btn{_bind(t){var e=this;e._unbind&&e._unbind(),t._element.onmousedown=function(){e._value(!0),e._sendAction(!0)},t._element.onmouseup=function(){e._value(!1),e._sendAction(!1)},e._unbind=function(){t._element.onmousedown=t._element.onmouseup=null}}v(t){this._setAttrC("v",t)}},gui.Hold.prototype.type="hold",addCSS('\n[type=\'select\'] {display:block;text-align:left}\n[type=\'select\']:empty {text-align:center}\n[v="true"] {background-color:var(--colorTrue) !important;}\n[type=\'select\']:not([v="true"]):before {content:"\\2610" " ";display:inline;}\n[type=\'select\'][v="true"]:before {content:"\\2611" " ";display:inline;}\n[type=\'select\'][group]:not([v="true"]):before {content:"\\029be" " ";display:inline;}\n[type=\'select\'][group][v="true"]:before {content:"\\029bf" " ";display:inline;}\n'),gui.Select=class extends gui.Btn{_bind(t){var e=this;e._unbind&&e._unbind(),t._element.onclick=function(){e._prop.v?(e._sendAction(!1),e._value(!1),t._setAttrC("v","false")):(e._sendAction(!0),e._value(!0),t._setAttrC("v","true"))},e._unbind=function(){t._element.onclick=null}}v(t){this._setAttrC("v",t);var e=this._attr("group");e&&(t?(gui.selectGroups[e]&&gui.selectGroups[e]!==this&&(gui.selectGroups[e]._prop.v=!1,gui.selectGroups[e]._setAttrC("v",!1),gui.selectGroups[e]._parent._containerBoolean&&gui.selectGroups[e]._parent._setAttr("v",!1)),gui.selectGroups[e]=this):gui.selectGroups[e]===this&&(gui.selectGroups[e]=void 0))}group(t){this._setAttr("group",t)}},gui.Select.prototype.type="select",gui.selectGroups={},addCSS("\n[type='html'] > .title:not(empty) {border-bottom:solid 1px var(--colorBorder);width:25%;}\n[type='html'] > [v] {white-space:normal;}\n"),gui.Html=class extends gui.Txt{v(t){this._content.innerHTML=t}},gui.Html.prototype.type="html",gui.Html.prototype.eT=function(t){t>0?(this._content.innerText=this._prop.v,gui.Txt.prototype.eT.call(this,t)):this._attrC("contenteditable")&&(this._content.removeAttribute("contenteditable"),this._content.innerHTML=this._prop.v)},addCSS("\n[type='mkdn'] > .title:not(empty) {border-bottom:solid 1px var(--colorBorder);width:25%;}\n"),gui.Mkdn=class extends gui.Html{v(t){this._content.innerHTML=gui.markdown(t)}},gui.Mkdn.prototype.type="mkdn",gui.Mkdn.prototype.eT=function(t){t>0?(this._content.innerText=this._prop.v,gui.Txt.prototype.eT.call(this,t)):this._attrC("contenteditable")&&(this._content.removeAttribute("contenteditable"),this._content.innerHTML=gui.markdown(this._prop.v))},addCSS("\n[type='popup'] {position:absolute;top:0px;left:0px;width:99%;height:99%;background-color:rgba(255,255,255,.5);pointer-events:all}\n[type='popup'] > div {top:50%;left:50%;transform:translate(-50%,-50%);width:50%;border:solid 1px gray;border-radius:4px;background-color:var(--color0);padding:1em}\n[type='popup'] > * > .title:empty {width:0px;height:0px;overflow:hidden}\n[type='popup'] > * > .title:not(empty) {border-bottom:solid 1px var(--colorBorder);width:25%;}\n"),gui.Popup=class extends gui.Bin{_initContent(){this._element=document.createElement("div"),this._frame=this._element.appendChild(document.createElement("div")),this._title=this._frame.appendChild(document.createElement("div")),this._content=this._frame.appendChild(document.createElement("div")),this._content.style.overflow="auto",this._parent._placeChildElement(this),this._childmap={}}},gui.Popup.prototype.type="popup",addCSS('\n[type="table"] > .title:not(empty) {border-bottom:solid 1px var(--colorBorder);width:25%;}\n[type="table"] {display:flex;flex-direction:column}\n[type="table"] > div {overflow:auto;flex:1 1 auto}\ntable {border-spacing:0;border-collapse:collapse;}\ntable[head="1"] > tr:first-child > * {font-weight:bold;background:var(--colorHead);z-index:1;position:relative}\ntd.title:empty {display:table-cell}\n'),gui.Table=class extends gui.Bin{_initContent(){this._element=document.createElement("div"),this._title=this._element.appendChild(document.createElement("div")),this._frame=this._element.appendChild(document.createElement("div")),this._frame.style.overflow="auto",this._content=this._frame.appendChild(document.createElement("table")),this._parent._placeChildElement(this),this._childmap={}}_newChild(t){var e=gui.getType(t);if(!e){var i=gui.getType(this._defaults);"v"in t?(e=gui.defaultType(t.v),i&&e.prototype instanceof i&&(e=i)):i?e=i:"v"in this._defaults?e=gui.defaultType(this._defaults.v):(e=gui.Bin,t.v=[])}if(e==gui.Bin){var n=new gui.TableRow(t,this);"number"!=typeof t.id&&(this._childmap[t.id]=n)}}},gui.Table.prototype.type="table",gui.TableRow=class extends gui.Bin{_initContent(){this._element=document.createElement("tr"),this._title=this._element.appendChild(document.createElement("td")),this._content=this._element,this._parent._placeChildElement(this),this._childmap={}}_placeChildElement(t){var e=this._content.appendChild(document.createElement("td"));e.appendChild(t._element),t._outterElement=e}},gui.TableRow.prototype.type="tableRow",gui.Table.prototype._floatRow=function(t){var e=this.scrollTop?"translate(0,"+(this.scrollTop-3)+"px)":null,i=this.firstChild.firstChild.querySelectorAll("td");for(var n in i)i[n]&&i[n].style&&(i[n].style.transform=e)},gui.Table.prototype.head=function(t){this._setAttrC("head",t),t?this._frame.addEventListener("scroll",this._floatRow):(this._content.firstChild.style.transform=null,this._frame.removeEventListener("scroll",this._floatRow))},addCSS('\n[type="ln"] > [v] > * {margin-bottom:1em;}\n[type="ln"] div:empty {width:0px;height:0px;margin:0px}\nsvg {width:100%;height:100%;left:0px;top:0px;position:absolute;z-index:0}\n'),gui.getMarker=function(t,e){var i;if("arrow"===t||"dot"===t){if(i="marker."+t+"."+e,!document.getElementById(i)){var n;gui.svgdefs||(gui.svgdefs=document.body.appendChild(createSVG("svg")).appendChild(createSVG("defs")),gui.svgdefs.parentElement.style.height="0px");var o=gui.svgdefs.appendChild(createSVG("marker"));o.id=i,o.setAttribute("orient","auto-start-reverse"),o.setAttribute("markerUnits","strokeWidth"),"arrow"===t?(o.setAttribute("viewBox","0 0 10 10"),o.setAttribute("refX","9"),o.setAttribute("refY","5"),o.setAttribute("markerWidth","6"),o.setAttribute("markerHeight","4"),(n=o.appendChild(createSVG("path"))).setAttribute("d","M 0 0 L 10 5 L 0 10 z")):(o.setAttribute("refX","2"),o.setAttribute("refY","2"),o.setAttribute("markerWidth","5"),o.setAttribute("markerHeight","5"),(n=o.appendChild(createSVG("circle"))).setAttribute("cx","2"),n.setAttribute("cy","2"),n.setAttribute("r","1.1")),n.setAttribute("fill",gui.color(e))}i="url(#"+i+")"}return i},gui.Ln=class extends gui.Bin{_initContent(){super._initContent(),this._svg=this._content.appendChild(createSVG("svg")),this._path=this._svg.appendChild(createSVG("path")),this._path.setAttribute("fill","none"),this._path.setAttribute("stroke","var(--color1)"),this._path.setAttribute("stroke-width","1")}_drawPath(){this._prop.lw||(this._prop.lw=1),this._prop.lc||(this._prop.lc=1);var t="";for(var e of this._content.children)e._item&&(e.offsetHeight?(t&&(t+=e.offsetLeft+e.offsetWidth/2+","+e.offsetTop+" "),e.nextElementSibling&&(t+="M"+(e.offsetLeft+e.offsetWidth/2)+","+(e.offsetTop+e.offsetHeight)+" ")):(t||(t="M"),t+=e.offsetLeft+","+e.offsetTop+" "));this._path.setAttribute("d",t)}v(t){super.v(t),this._drawPath()}},gui.Ln.prototype.type="ln",gui.Ln.prototype.shape=function(){},gui.Ln.prototype.dir=function(t){1==t?(this._path.setAttribute("marker-start",gui.getMarker("dot",this._prop.lc)),this._path.setAttribute("marker-mid",gui.getMarker("arrow",this._prop.lc)),this._path.setAttribute("marker-end",gui.getMarker("arrow",this._prop.lc))):2==t?(this._path.setAttribute("marker-start",gui.getMarker("arrow",this._prop.lc)),this._path.setAttribute("marker-mid",gui.getMarker("dot",this._prop.lc)),this._path.setAttribute("marker-end",gui.getMarker("arrow",this._prop.lc))):(this._path.removeAttribute("marker-start"),this._path.removeAttribute("marker-mid"),this._path.removeAttribute("marker-end"))};
