<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<html><head>
<script src="stap.js"></script>
<script>
var task = {
	
	SAMPLE_CODE:new Map([
		['some text',`[ "Hello World!" ]`],
		['a button',`[ {"id":"Press Me","v":false} ]`],
		['container w/ radio buttons',`[
 {
  "id":"Choose a car",
  "select":1,
  "v":[
   {"id":"Subaru","v":false},
   {"id":"Ford","v":false},
   {"id":"Tesla","v":false}
  ]
 }
]`],
		['container w/ checkboxes',`[
 {
  "id":"Choose cars",
  "select":2,
  "v":[
   {"id":"Subaru","v":false},
   {"id":"Ford","v":false},
   {"id":"Tesla","v":false}
  ]
 }
]`],
		['box',`[ {"bg":2,"w":50,"h":50} ]`],
		['color change every 1.5s',`[
 {"id":"time","v":10.5,"rnd":0.001,"S":10.5},
 {"id":"boxy","w":50,"h":50,"bd":"solid"},
 {"id":"boxy","bg":1,"T":1.5},
 {"id":"boxy","bg":2,"T":3},
 {"id":"boxy","bg":3,"T":4.5},
 {"id":"boxy","bg":4,"T":6},
 {"id":"boxy","bg":5,"T":7.5},
 {"id":"boxy","bg":6,"T":9},
 {"id":"boxy","bg":7,"T":10.5}
]`],
		['bouncing ball',`[
 {"id":"ball","bg":3,"w":50,"h":50,"r":25,"x":0,"y":0},
 {"id":"ball","x":200,"S":2},
 {"id":"ball","y":200,"S":2,"ease":"bounce"}
]`]
	]),
	
	start: function(){
		task.updateUI({
			require:{options:['S','ease']},
			template:`
				[level="0"]>[v] {height:100%;display:flex;flex-direction:column}
				#Preview {border:solid 1px gray;margin-top:2em}
				#Preview>.title {top:-2em;position:absolute}
				#STAP {flex:1 1 auto;display:flex;flex-direction:column}
				#STAP>[v] {flex:1 1 auto}
				#Warning {text-align:right}
				#Warning * {display:inline}
			`
		});
		task.updateUI([
			{id:"STAP",v:"",eT:4},
			{id:"Preview",h:400}
		]);
		for(var i of task.SAMPLE_CODE.keys())
			task.updateUI([{id:"Sample Code",v:[{id:i,v:false}]}]);
	},
	
	userAction: function(time,element,value){
		task.updateUI({$:'Warning',v:null}); //remove any previously shown warning
		if(element=='STAP'){
			try{
				task.updateUI([{id:'Preview',v:""},{id:'Preview',v:JSON.parse(value)}]);
			}catch(e){
				task.updateUI([{id:'Warning',v:'Invalid JSON string',P:1}]);
			}
		}else{
			if(task.SAMPLE_CODE.has(element)){
				task.sampleCode(task.SAMPLE_CODE.get(element));
			}
		}
	},
	
	sampleCode: function(stap){
		task.updateUI([
			{id:'Preview',v:''},
			{id:'STAP',v:stap},
			{id:'Preview',v:JSON.parse(stap)}
		]);
	}

}
logToConsole();
</script>
</head><body /></html>
